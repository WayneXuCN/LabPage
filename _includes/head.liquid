<!-- Metadata, OpenGraph and Schema.org -->
{% include metadata.liquid %}

<!-- Security: Content Security Policy -->
<!-- Permissive CSP suitable for academic websites. Allows external images, videos, and common embed services. -->
<!-- To customize for your needs, see: https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
<meta
  http-equiv="Content-Security-Policy"
  content="default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' data: https:; media-src 'self' https:; frame-src 'self' https:; connect-src 'self' https:;">

<!-- Bootstrap & MDB -->
<link rel="stylesheet" href="{{ '/assets/css/bootstrap.min.css' | relative_url | bust_file_cache }}">
<link
  rel="stylesheet"
  href="{{ site.third_party_libraries.mdb.url.css }}"
  integrity="{{ site.third_party_libraries.mdb.integrity.css }}"
  crossorigin="anonymous">

{% if page.pretty_table %}
  <!-- Bootstrap Table -->
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.bootstrap-table.url.css }}"
    integrity="{{ site.third_party_libraries.bootstrap-table.integrity.css }}"
    crossorigin="anonymous">
{% endif %}

<!--
  ============================================
  字体加载优化 (Font Loading Optimization)
  ============================================
-->

<!-- 预连接到 Google Fonts 服务器，减少 DNS 和 TCP 握手时间 -->
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- 预加载关键字体文件，减少 FOIT (Flash of Invisible Text) -->
<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="https://fonts.gstatic.com/s/sourcesanspro/v22/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7lujVj9w.woff2"
  crossorigin>
<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="https://fonts.gstatic.com/s/sourceserifpro/v15/neIQzD-0qpwxpaWvjeD0X88SAOeasasatSyqxKcsdrM.woff2"
  crossorigin>

<!-- Fonts & Icons -->
<link
  defer
  rel="stylesheet"
  href="{{ '/assets/css/academicons.min.css' | relative_url | bust_file_cache }}">
<link
  defer
  rel="stylesheet"
  href="{{ '/assets/css/scholar-icons.css' | relative_url | bust_file_cache }}">
<link
  defer
  rel="stylesheet"
  type="text/css"
  href="{{ site.third_party_libraries.google_fonts.url.fonts }}">

<!-- Code Syntax Highlighting -->
<link
  defer
  rel="stylesheet"
  href="{{ '/assets/css/jekyll-pygments-themes-github.css' | relative_url | bust_file_cache }}"
  media=""
  id="highlight_theme_light">

{% if page.toc and page.toc.sidebar %}
  <!-- Sidebar Table of Contents -->
  <link
    defer
    href="{{ '/assets/css/bootstrap-toc.min.css' | relative_url | bust_file_cache }}"
    rel="stylesheet">
{% endif %}

<!-- Styles -->

{% if page.pseudocode %}
  <!-- pseudocode -->
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.pseudocode.url.css }}"
    integrity="{{ site.third_party_libraries.pseudocode.integrity.css }}"
    crossorigin="anonymous">
{% endif %}

{% if site.icon.size <= 4 %}
  <link
    rel="shortcut icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>{{ site.icon }}</text></svg>">
{% elsif site.icon != blank %}
  <link rel="shortcut icon" href="{{ site.icon | prepend: '/assets/img/' | relative_url | bust_file_cache}}">
{% endif %}
<link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url | bust_css_cache }}">
<link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">

{% if page.noindex or page.sitemap == false %}
  <meta name="robots" content="noindex">
{% endif %}

<!-- Dark Mode -->
{% if site.enable_darkmode %}
  <script src="{{ '/assets/js/theme.js' | relative_url | bust_file_cache }}"></script>
  <link
    defer
    rel="stylesheet"
    href="{{ '/assets/css/jekyll-pygments-themes-native.css' | relative_url | bust_file_cache }}"
    media="none"
    id="highlight_theme_dark">
  <script>
    initTheme();
  </script>
{% endif %}

{% if page.map %}
  <!-- GeoJSON support via Leaflet -->
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.leaflet.url.css }}"
    integrity="{{ site.third_party_libraries.leaflet.integrity.css }}"
    crossorigin="anonymous">
{% endif %}

{% if page.code_diff %}
  <!-- diff2html -->
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.highlightjs.url.css.light }}"
    integrity="{{ site.third_party_libraries.highlightjs.integrity.css.light }}"
    crossorigin="anonymous"
    media="screen and (prefers-color-scheme: light)">
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.highlightjs.url.css.dark }}"
    integrity="{{ site.third_party_libraries.highlightjs.integrity.css.dark }}"
    crossorigin="anonymous"
    media="screen and (prefers-color-scheme: dark)">
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.diff2html.url.css }}"
    integrity="{{ site.third_party_libraries.diff2html.integrity.css }}"
    crossorigin="anonymous">
{% endif %}

{% if page.images %}
  {% if page.images.compare %}
    <!-- Image comparison slider -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.img-comparison-slider.url.css }}"
      integrity="{{ site.third_party_libraries.img-comparison-slider.integrity.css }}"
      crossorigin="anonymous">
  {% endif %}
  {% if page.images.lightbox2 %}
    <!-- Lightbox2 -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.lightbox2.url.css }}"
      integrity="{{ site.third_party_libraries.lightbox2.integrity.css }}"
      crossorigin="anonymous">
  {% endif %}
  {% if page.images.photoswipe %}
    <!-- Photoswipe -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.photoswipe.url.css }}"
      crossorigin="anonymous">
  {% endif %}
  {% if page.images.slider %}
    <!-- Image slider -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.swiper.url.css }}"
      integrity="{{ site.third_party_libraries.swiper.integrity.css }}"
      crossorigin="anonymous">
  {% endif %}
  {% if page.images.spotlight %}
    <!-- Spotlight -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.spotlight.url.css }}"
      integrity="{{ site.third_party_libraries.spotlight.integrity.css }}"
      crossorigin="anonymous">
  {% endif %}
  {% if page.images.venobox %}
    <!-- Venobox -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.venobox.url.css }}"
      integrity="{{ site.third_party_libraries.venobox.integrity.css }}"
      crossorigin="anonymous">
  {% endif %}
{% endif %}

{% if page.tikzjax %}
  <link
    defer
    rel="stylesheet"
    type="text/css"
    href="{{ '/assets/css/tikzjax.min.css' | relative_url | bust_file_cache }}">
{% endif %}

{% if site.enable_cookie_consent %}
  <!-- Cookie Consent -->
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.vanilla-cookieconsent.url.css }}"
    integrity="{{ site.third_party_libraries.vanilla-cookieconsent.integrity.css }}"
    crossorigin="anonymous">
{% endif %}
