---
layout: post
title: 低性能云服务器实用配置记录
date: 2025-02-12 17:05:53
last_updated: 2025-05-31 12:12:12
description: 配置云服务器记录
tags: Server Configuration
categories: Tools
featured: false
giscus_comments: true
related_posts: true
toc:
  sidebar: right
---

## 服务器配置概览

最近买了一台阿里云 ECS 云服务器，很便宜，配置如下：

- **CPU**: 2 核（vCPU）
- **内存**: 2 GiB
- **存储**: 云盘40 GiB（2120 IOPS）
- **网络**: 固定带宽 3M

配置极低，本文记录了在使用过程中遇到的各种问题和解决方案。

## 配置优化

### pnpm 配置优化

由于内存和CPU限制，pnpm 在安装依赖时容易出现卡死现象，需要限制并发和重试参数：

```bash
# 限制并发数，避免内存不足
pnpm config set concurrency 2

# 禁用 pnpm 的自动锁文件更新，可以减少在安装时的磁盘 IO 负担
pnpm config set auto-install-peers=false

# 设置重试次数，提高网络不稳定时的成功率
pnpm config set fetch-retries 3

# 设置重试因子，增加重试间隔时间
pnpm config set fetch-retry-factor 2

# 设置网络超时时间
pnpm config set network-timeout 60000
```

### SSH 密钥管理

使用 `keychain` 工具来统一管理 SSH 和 GPG 密钥代理（agent），实现一次解锁、多会话共享。

```bash
# 安装 keychain
# Debian/Ubuntu
sudo apt install keychain
# CentOS/RHEL
sudo dnf install keychain
```

配置自动加载，编辑 shell 初始化文件（如 `.bash_profile` 或 `.profile`），添加以下内容（根据实际密钥路径调整）：

```bash
# 启动 keychain 管理 SSH 和 GPG 密钥
if command -v keychain > /dev/null; then
    eval $(keychain --quiet --eval ~/.ssh/id_rsa)
fi

# 如果使用 GPG 进行签名或加密，也可以一并托管：
eval $(keychain --quiet --eval ~/.ssh/id_rsa GPG_KEY_EMAIL@DOMAIN.COM)
```

> 使用 `--quiet` 参数可避免每次登录时输出提示信息（例如 `* Found existing ssh-agent: 1996`），适合生产环境静默运行。
> 其中 `GPG_KEY_EMAIL@DOMAIN.COM` 替换为你的 GPG 密钥绑定邮箱。

第一次登录时会提示输入私钥密码，后续新开终端或 SSH 会话将自动复用已解锁的 agent。多个 shell 之间共享同一组密钥，无需重复解密。
