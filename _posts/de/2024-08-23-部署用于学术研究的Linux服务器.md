---
layout: post
title: Einrichtung eines Linux-Servers für wissenschaftliche Forschung
date: 2024-08-24 14:34:28
last_updated: 2024-11-01 14:34:28
description: Wie man einen Linux-Server für akademische Zwecke einrichtet
tags: Ubuntu Productivity Deployment Server
categories: Productivity
featured: false
giscus_comments: true
related_posts: true
toc:
  sidebar: right
---

Kürzlich habe ich einen MiniPC in einen Server auf Basis von Ubuntu umgewandelt und ihn so konfiguriert, dass er den potenziellen Anforderungen zukünftiger Forschungsprojekte entspricht。

Da ich nur begrenzte Kenntnisse über Linux hatte, habe ich einige Zeit damit verbracht, mich einzuarbeiten und die Einrichtung zu dokumentieren – inklusive möglicher Probleme und deren Lösungen。

---

## Einen neuen Benutzer mit Administratorrechten unter Ubuntu anlegen

Wenn Sie einen Ubuntu-Server (egal ob von einem Cloud-Anbieter oder selbst installiert) nutzen, wird standardmäßig ein Benutzerkonto erstellt。Dieser Benutzer kann mit `sudo` temporär Administratorrechte erhalten, ist aber kein echter Admin-Account。Um einen eigenen Benutzer mit denselben Rechten zu erstellen, gehen Sie wie folgt vor：

### 1. Neuen Benutzer mit Home-Verzeichnis und Shell anlegen

```bash
sudo useradd -d "/home/<user_name>" -m -s "/bin/bash" <user_name>
```

Parametererklärung：

- `-d "/home/<user_name>"`：Setzt das Home-Verzeichnis。
- `-m`：Erstellt das Home-Verzeichnis automatisch。
- `-s "/bin/bash"`：Legt die Standardshell fest。

### 2. Dem neuen Benutzer Administratorrechte geben

Um einen Benutzer mit sudo-Rechten zu erstellen：

```bash
sudo useradd -d "/home/<user_name>" -m -s "/bin/bash" -G sudo <user_name>
```

- `-G sudo`：Fügt den Benutzer der Gruppe `sudo` hinzu。

### 3. Passwort für den neuen Benutzer setzen

Standardmäßig hat der neue Benutzer kein Passwort。Setzen Sie eines mit：

```bash
sudo passwd <user_name>
```

Geben Sie das Passwort zweimal ein (es wird nichts angezeigt)。Danach kann der neue Benutzer mit `sudo` arbeiten。

---

## Terminal-Optik verbessern

Ein schönes und funktionales Terminal erhöht die Arbeitsfreude。Ich empfehle `zsh` für ein ansprechendes Prompt。Details siehe [frühere Anleitung](/blog/2022/Linux实用配置记录/)。

---

## Remote-Zugriff auf den Server aktivieren

Um von außerhalb auf den Ubuntu-Server zuzugreifen, installieren und konfigurieren Sie den SSH-Dienst und passen ggf. die Firewall an。

### 1. SSH-Server installieren und konfigurieren

Für grundlegenden SSH-Zugang genügt die Installation von `openssh-server`：

```bash
sudo apt update
sudo apt install openssh-server
```

Status prüfen：

```bash
sudo systemctl status ssh
```

- **Konfigurationstipps**：

  - **Root-Login deaktivieren** (empfohlen)：In `/etc/ssh/sshd_config` `PermitRootLogin no` setzen。

    ```bash
    sudo nano /etc/ssh/sshd_config
    ```

    ```plaintext
    PermitRootLogin no
    ```

  - **Zugelassene Benutzer einschränken**：Mit `AllowUsers` nur bestimmten Benutzern SSH-Zugang erlauben。

    ```plaintext
    AllowUsers <user_name>
    ```

  - **Nicht-Standard-Port verwenden** (optional)：Port z.B. auf 2200 ändern。

    ```plaintext
    Port 2200
    ```

  - **Automatische Trennung bei Inaktivität**：

    ```plaintext
    ClientAliveInterval 300
    ClientAliveCountMax 2
    ```

Nach Änderungen SSH-Dienst neu starten：

```bash
sudo systemctl restart ssh
```

### 2. UFW-Firewall konfigurieren

Wenn UFW aktiviert ist, SSH-Port freigeben：

```bash
sudo ufw allow ssh
```

Bei geändertem Port (z.B. 2200)：

```bash
sudo ufw allow 2200/tcp
```

Firewall aktivieren und Status prüfen：

```bash
sudo ufw enable
sudo ufw status
```

### 3. SSH-Verbindung testen

Unter Windows empfiehlt sich [PuTTY](https://www.putty.org/) oder [Windows Terminal](https://aka.ms/terminal)。Verbindung testen：

```bash
telnet <remote_ip> <remote_port>
```

Ersetzen Sie `<remote_ip>` und `<remote_port>` entsprechend。

### 4. .Xauthority-Berechtigungsproblem beheben

Falls `/home/<user_name>/.Xauthority` falsche Rechte hat：

```bash
sudo chown <user_name>:<user_name> -R /home/<user_name>
```

Falls nötig, Datei neu anlegen：

```bash
sudo -u <user_name> touch /home/<user_name>/.Xauthority
sudo chown <user_name>:<user_name> /home/<user_name>/.Xauthority
```

### 5. Fail2Ban einrichten (empfohlen)

Zum Schutz vor Brute-Force-Angriffen：

```bash
sudo apt install fail2ban
```

Konfiguration in `/etc/fail2ban/jail.local` anpassen：

```plaintext
[sshd]
enabled = true
port = 22
maxretry = 5
bantime = 600
```

---

## SSH-Verbindung zwischen Server und GitHub einrichten

So verbinden Sie Ihren Ubuntu-Server sicher mit GitHub：

### 1. Git installieren und prüfen

```bash
sudo apt install git
git --version
```

### 2. Git-Benutzerdaten konfigurieren

```bash
git config --global user.name "<github_account_name>"
git config --global user.email "<github_account_email>"
```

### 3. SSH-Schlüsselpaar generieren

```bash
ssh-keygen -C "<github_account_email>" -t rsa
```

Drücken Sie dreimal Enter, um Standardwerte zu übernehmen。

### 4. SSH-Public-Key zu GitHub hinzufügen

```bash
cat ~/.ssh/id_rsa.pub
```

Kopieren Sie den Inhalt und fügen Sie ihn unter GitHub → Settings → SSH and GPG keys → New SSH key ein。

### 5. Verbindung zu GitHub testen

```bash
ssh -T git@github.com
```

Bei Erfolg erscheint：

```plaintext
Hi <github_account_name>! You've successfully authenticated, but GitHub does not provide shell access.
```

### 6. Häufige Probleme und Lösungen

1. **SSH-Key-Berechtigungen prüfen**：

   ```bash
   chmod 600 ~/.ssh/id_rsa
   chmod 644 ~/.ssh/id_rsa.pub
   ```

2. **Key zum SSH-Agent hinzufügen**：

   ```bash
   eval "$(ssh-agent -s)"
   ssh-add ~/.ssh/id_rsa
   ```

---

## Python-Umgebung einrichten und verwalten

---

### Miniforge

Für das Management von Python-Umgebungen empfehle ich Miniforge (leichtgewichtig, schnell, basiert auf conda-forge und Mamba)。

#### 1. Miniforge installieren

Siehe [Miniforge GitHub](https://github.com/conda-forge/miniforge)：

```bash
wget "https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-$(uname)-$(uname -m).sh"
bash Miniforge3-$(uname)-$(uname -m).sh
```

- Empfehlung：Installation in `/usr/local/miniforge3` für gemeinsame Nutzung。
- Bei ZSH：Pfad zu `.zshrc` hinzufügen：

  ```bash
  export PATH="$usr/local/miniforge3/bin:$PATH"
  ```

  Danach：`source ~/.zshrc`

#### 2. Mamba initialisieren

```bash
/usr/local/miniforge3/bin/mamba init
```

Falls ZSH nicht automatisch erkannt wird, Konfiguration aus `.bashrc` übernehmen。

#### 3. Umgebungen erstellen und verwalten

Empfohlen：Umgebungen als root anlegen。

##### Neue Umgebung erstellen

```bash
mamba create --name <new_env_name> python=3.11 --no-default-packages
```

Oder für private Umgebung：

```bash
mamba create --prefix /home/username/myenv python=3.11 --no-default-packages
```

##### Umgebung löschen

```bash
mamba remove --name <env_name> --all
mamba remove --prefix /path/to/directory --all
```

#### 4. Häufig genutzte Pakete installieren

Nicht direkt im `base`-Environment arbeiten。Beispiel für Machine-Learning-Umgebung：

```bash
mamba create --name ml_env python=3.12 jupyterhub jupyterlab notebook notebook scipy numpy numpy
mamba activate ml_env
mamba install jupyter-lsp-python jupyterlab-lsp jupyterlab-git jupyterlab_execute_time
```

#### 5. Schreibschutz für Umgebungen

Normale Nutzer können Systemumgebungen nicht aktualisieren：

```bash
mamba update --all
```

Fehlermeldung：

```plaintext
EnvironmentNotWritableError: The current user does not have write permissions to the target environment.
  environment location: /usr/local/miniforge3
  uid: 1000
  gid: 1000
```

Mit `sudo` kann ein Update durchgeführt werden：

```bash
sudo /usr/local/miniforge3/bin/mamba update --all
```

---

### Poetry

Poetry ist ein effizientes Tool für das Management von Python-Projekten und Abhängigkeiten。

#### 1. Poetry installieren

Python 3.7+ erforderlich。

```bash
curl -sSL https://install.python-poetry.org | python3 -
```

Pfad ggf. ergänzen：

```bash
export PATH="$HOME/.local/bin:$PATH"
```

Installation prüfen：

```bash
poetry --version
```

#### 2. Neues Projekt anlegen

```bash
poetry new my_project
```

Struktur：

```
my_project/
├── my_project/
│   └── __init__.py
├── pyproject.toml
└── tests/
    └── __init__.py
```

Vorhandenes Projekt initialisieren：

```bash
cd existing_project
poetry init
```

#### 3. Abhängigkeiten verwalten

Produktiv-Abhängigkeit hinzufügen：

```bash
poetry add requests
```

Entwickler-Abhängigkeit：

```bash
poetry add pytest --dev
```

Alle Abhängigkeiten installieren：

```bash
poetry install
```

#### 4. Virtuelle Umgebung verwalten

Aktivieren：

```bash
poetry shell
```

Verlassen：`exit`

Pfad anzeigen：

```bash
poetry env info --path
```

Umgebung löschen：

```bash
poetry env remove python
```

#### 5. Lock-Datei verwalten

Abhängigkeiten aktualisieren：

```bash
poetry update
```

Installieren gemäß Lock-Datei：

```bash
poetry install
```

#### 6. Skripte und Befehle ausführen

Im virtuellen Environment：

```bash
poetry run python script.py
poetry run pytest
```

#### 7. Python-Paket veröffentlichen

Bauen：

```bash
poetry build
```

Auf PyPI veröffentlichen：

```bash
poetry publish --build
```

Für Test-PyPI：

```bash
poetry publish --repository testpypi
```

---

Im Folgenden eine Anleitung zur Einrichtung einer R-Umgebung für ökonometrische Analysen。

---

## R-Umgebung unter Ubuntu für Ökonometrie einrichten

R eignet sich hervorragend für ökonometrische Analysen, Regressions- und Zeitreihenanalysen。

### 1. R installieren

Für die neueste Version CRAN-Repository hinzufügen：

```bash
sudo apt update
sudo apt install software-properties-common dirmngr -y
```

GPG-Key hinzufügen：

```bash
wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | sudo tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
```

Key prüfen (optional)：

```bash
gpg --show-keys /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
```

CRAN-Repository hinzufügen：

```bash
sudo add-apt-repository "deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"
```

R und Dev-Pakete installieren：

```bash
sudo apt install r-base r-base-dev -y
```

### 2. RStudio installieren

RStudio ist eine leistungsfähige IDE für R。Installationsanleitung siehe [RStudio-Website](https://posit.co/download/rstudio-server/)。

1. RStudio Server herunterladen。
2. Installieren：

   ```bash
   sudo dpkg -i rstudio-server-<version>.deb
   ```

3. Status prüfen：

   ```bash
   sudo systemctl status rstudio-server
   ```

Danach erreichbar unter `http://<your-server-ip>:8787`。

### 3. Ökonometrie-Pakete installieren

Systemabhängigkeiten installieren：

```bash
sudo apt-get install build-essential libssl-dev libcurl4-openssl-dev libxml2-dev
```

R-Konsole starten：

```bash
sudo R
```

Pakete installieren：

```r
chooseCRANmirror(graphics = FALSE)
install.packages(c("tidyverse", "data.table", "broom", "plm", "forecast", "lmtest", "sandwich", "stargazer"))
```

Weitere Pakete：

```r
install.packages(c("AER", "urca", "vars"))
install.packages(c("quantmod", "TTR", "zoo", "xts"))
```

### 4. GitHub-Token für private Pakete

Token generieren：

```r
usethis::create_github_token()
```

Token in R speichern：

```r
gitcreds::gitcreds_set()
```

### 5. Beispiel：Paneldatenregression mit `plm`

```r
library(plm)

data("Produc", package = "plm")
pdata <- pdata.frame(Produc, index = c("state", "year"))

fe_model <- plm(log(gsp) ~ log(pcap) + log(hwy) + log(water) + log(util), data = pdata, model = "within")
summary(fe_model)
```

---

## Sonstige Hinweise

---

### 1. Daten synchronisieren

Mit `rsync` Daten effizient übertragen。Details siehe [dieses Tutorial](https://www.digitalocean.com/community/tutorials/how-to-use-rsync-to-sync-local-and-remote-directories)。

```bash
rsync -r /path/to/sync/ <username>@<remote_host>:<destination_directory>
```

Fortschritt großer Dateien überwachen：

```bash
watch -n <time_interval> du -sh /path/to/large/file
```

---

### 2. Standard-Schriftarten installieren

Microsoft TrueType-Fonts installieren：

```bash
sudo apt install msttcorefonts
rm -rf ~/.cache/matplotlib
```

---

### 3. Treiber-/Bibliotheksversionen stimmen nicht überein

Fehler bei `nvidia-smi`：

```text
Failed to initialize NVML: Driver/library version mismatch
```

Siehe [Stack Overflow-Lösung](https://stackoverflow.com/questions/43022843/nvidia-nvml-driver-library-version-mismatch/45319156#45319156)：

1. **Server neu starten**：

   ```bash
   sudo reboot
   ```

2. **Nvidia-Treiber neu installieren**：

   ```bash
   sudo apt purge nvidia* libnvidia*
   sudo ubuntu-drivers install
   sudo reboot
   ```

---

### 4. Nvidia-Treiber aktualisieren

1. **Alte Treiber entfernen**：

   ```bash
   sudo apt purge *nvidia* -y
   sudo apt remove *nvidia* -y
   sudo rm /etc/apt/sources.list.d/cuda*
   sudo apt autoremove -y && sudo apt autoclean -y
   sudo rm -rf /usr/local/cuda*
   ```

2. **Empfohlene Treiberversion suchen und installieren**：

   ```bash
   ubuntu-drivers devices
   sudo apt install libnvidia-common-550-server libnvidia-gl-550-server nvidia-driver-550-server -y
   ```

3. **Neustart und Prüfung**：

   ```bash
   sudo reboot now
   ```

   Bei Fehler：

   ```text
   NVIDIA-SMI has failed because it couldn't communicate with the NVIDIA driver.
   ```

   Kernel-Header neu installieren und neu starten。

---

### 5. Kernel-Header und GCC

1. **Kernel-Header neu installieren**：

   ```bash
   sudo apt install --reinstall linux-headers-$(uname -r)
   sudo reboot
   ```

2. **GCC-Version aktualisieren**：

   Wenn Fehler auftreten, GCC auf Version 12 aktualisieren：

   ```bash
   sudo apt-get install gcc-12
   sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 12
   ```

   Kernel-Header erneut installieren und Server neu starten。Danach sollte `nvidia-smi` funktionieren。

<footer lang="de" style="
  background-color: #f8f9fa;
  color: #6c757d;
  font-size: 0.85rem;
  line-height: 1.5;
  padding: 1rem 1.5rem;
  margin-top: 2rem;
  border-top: 1px solid #e9ecef;
  text-align: center;
">
  <p style="margin: 0; word-break: break-word;">
    Diese Seite wurde automatisch von generativer KI übersetzt und kann Ungenauigkeiten oder unvollständige Informationen enthalten。
    <a href="mailto:wenjie.xu.cn@outlook.com" style="
      color: #007bff;
      text-decoration: none;
    ">Feedback ist willkommen</a>, um uns bei der Verbesserung zu helfen。
  </p>
</footer>
