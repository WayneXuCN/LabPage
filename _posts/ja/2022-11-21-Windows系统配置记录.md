---
layout: post
title: Windows システム設定記録
date: 2022-11-21 08:15:00
last_updated: 2024-09-12 15:17:34
description: Windows システムのソフトウェア設定と一般的なエラー解決策の記録
tags: Windows Configuration
categories: Tools
featured: false
giscus_comments: false
related_posts: true
toc:
  sidebar: right
---

Windows システムのソフトウェア設定やよくあるエラーの解決策を自分用にまとめておきます。毎回検索する手間を省くためです。

## システム設定

### 1. 右クリックメニュー

デスクトップの右クリックメニュー整理

```text
コンピューター\HKEY_CLASSES_ROOT\Directory\Background\shell
```

フォルダーの右クリックメニュー整理

```text
コンピューター\HKEY_CLASSES_ROOT\Directory\shell
コンピューター\HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers
コンピューター\HKEY_CLASSES_ROOT\Folder\shell
コンピューター\HKEY_CLASSES_ROOT\Folder\shellex\ContextMenuHandlers
```

ファイルの右クリックメニュー設定

```text
コンピューター\HKEY_CLASSES_ROOT\*\shellex\ContextMenuHandlers
```

### 2. リモートデスクトップ

Microsoft アカウントでリモートデスクトップにログインする際、常にパスワードエラーが出る場合があります。これは Microsoft アカウントのパスワード変更後、PC側で更新されていないことが原因かもしれません。このアカウント権限で `winver` を一度実行し、パスワードを更新してください。

```powershell
runas /u:MicrosoftAccount\wenjie.xu.cn@outlook.com winver
```

### 2. 機能インターフェース

仮想メモリをシステムドライブ以外に設定できるようにする（「起動時にページファイル構成の問題が発生したため、一時的なページファイルが作成されました」というエラー修正）

```powershell
reg add "HKLM\System\CurrentControlSet\Control\Session Manager\Memory Management" /v PagefileOnOsVolume /t REG_DWORD /d 0 /f
```

各エクスプローラーウィンドウを独立したプロセスとして実行し、安定性を向上させる

```powershell
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v SeparateProcess /t REG_DWORD /d 1 /f
```

ドライバーやカーネルモードのシステムコードを仮想メモリに入れない（ドライバーの安定性問題の解決に役立つ場合あり）

```powershell
reg add "HKLM\System\CurrentControlSet\Control\Session Manager\Memory Management" /v DisablePagingExecutive /t REG_D
```

デスクトップやエクスプローラーなどのフォントスケーリングが異常で設定から戻せない場合、レジストリでリセット

```powershell
Windows Registry Editor Version 5.00

[HKEY_CURRENT_USER\Control Panel\Desktop\WindowMetrics]
"IconTitleWrap"="1"
"Shell Icon Size"="32"
"BorderWidth"="-15"
"CaptionFont"=hex:f4,ff,ff,ff,00,00,00,00,00,00,00,00,00,00,00,00,90,01,00,00,\
  00,00,00,01,00,00,05,00,53,00,65,00,67,00,6f,00,65,00,20,00,55,00,49,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
"CaptionHeight"="-330"
"CaptionWidth"="-330"
"IconFont"=hex:f4,ff,ff,ff,00,00,00,00,00,00,00,00,00,00,00,00,90,01,00,00,00,\
  00,00,01,00,00,05,00,53,00,65,00,67,00,6f,00,65,00,20,00,55,00,49,00,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
"MenuFont"=hex:f4,ff,ff,ff,00,00,00,00,00,00,00,00,00,00,00,00,90,01,00,00,00,\
  00,00,01,00,00,05,00,53,00,65,00,67,00,6f,00,65,00,20,00,55,00,49,00,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
"MenuHeight"="-285"
"MenuWidth"="-285"
"MessageFont"=hex:f4,ff,ff,ff,00,00,00,00,00,00,00,00,00,00,00,00,90,01,00,00,\
  00,00,00,01,00,00,05,00,53,00,65,00,67,00,6f,00,65,00,20,00,55,00,49,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
"ScrollHeight"="-255"
"ScrollWidth"="-255"
"SmCaptionFont"=hex:f4,ff,ff,ff,00,00,00,00,00,00,00,00,00,00,00,00,90,01,00,\
  00,00,00,00,01,00,00,05,00,53,00,65,00,67,00,6f,00,65,00,20,00,55,00,49,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
"SmCaptionHeight"="-330"
"SmCaptionWidth"="-330"
"StatusFont"=hex:f4,ff,ff,ff,00,00,00,00,00,00,00,00,00,00,00,00,90,01,00,00,\
  00,00,00,01,00,00,05,00,53,00,65,00,67,00,6f,00,65,00,20,00,55,00,49,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\
  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
"AppliedDPI"=dword:00000060
"PaddedBorderWidth"="-60"
"IconSpacing"="-1125"
"IconVerticalSpacing"="-1125"
"MinAnimate"="0"
```

## 開発環境設定

### 1. Scoop パッケージマネージャー

[Scoop](https://scoop.sh/) は Windows プラットフォームで最も使いやすいソフトウェア（パッケージ）マネージャーです。コマンドラインで簡単にソフトをインストールできます。主な特徴は以下の通りです：

- 権限昇格のポップアップを排除
- 多数のプログラムインストールによる PATH 汚染を防止
- インストールやアンインストール時の予期せぬ副作用を回避
- 依存関係を自動で検索・インストール
- 実行可能なプログラムを得るための追加設定を自動実行

注意点として、Scoop で管理するツールは、インストールした複数バージョンがそれぞれのフォルダに保存され、いつでも切り替えやロールバックが可能です。例えば、エクスプローラーで `C:\Users\Xu\scoop\apps\oh-my-posh` フォルダを見ると、バージョン番号ごとのサブフォルダが複数あります。現在有効なバージョンは `current` ディレクトリに表示され、どのバージョンへのシンボリックリンクか確認できます。

不要な古いバージョンのサブフォルダは手動で削除できます。例えば 7.68.0 と 7.69.1 の2つのフォルダがあり、最新の 7.69 だけ残したい場合は `C:\Users\Xu\scoop\apps\oh-my-posh` に移動し、古いバージョン（例: 7.68.0）を削除します。もしくはコマンドで未使用の古いバージョンを自動クリーンアップできます：

```bash
scoop cleanup oh-my-posh
# すべてのソフトの旧バージョンをクリーンアップ
scoop cleanup *
# インストールパッケージキャッシュを削除
scoop cache rm *
```

Scoop でインストールしているソフト一覧：

```bash
Name                   Version            Source Updated             Info
----                   -------            ------ -------             ----
7zip                   24.09              main   2024-12-02 16:34:26
aria2                  1.37.0-1           main   2024-11-11 21:58:04
btop                   1.0.4              main   2024-07-17 21:29:16
btop-lhm               1.0.4              main   2024-07-17 21:29:25
draw.io                25.0.2             extras 2024-12-05 15:24:34
everything             1.4.1.1026         extras 2024-12-04 14:25:38
fastfetch              2.33.0             main   2024-12-28 23:17:29
fd                     10.2.0             main   2024-12-22 12:47:35
ffmpeg                 7.1                main   2024-10-20 18:21:52
fzf                    0.57.0             main   2024-12-22 12:47:39
geekuninstaller        1.5.2.165          extras 2024-12-03 16:21:50
gh                     2.64.0             main   2024-12-22 12:57:21
ghostscript            10.04.0            main   2024-12-22 12:49:34
git                    2.47.1             main   2024-12-02 16:46:01
imagemagick            7.1.1-43           main   2024-12-25 22:26:47
innounp                1.76               main   2024-11-14 10:58:02
jid                    0.7.6              main   2024-12-22 12:49:50
jq                     1.7.1              main   2024-12-22 12:47:28
mingw                  14.2.0-rt_v12-rev0 main   2024-12-05 15:37:08
mongodb                8.0.4              main   2024-12-08 12:22:01
mongodb-compass        1.45.0             extras 2024-12-05 15:24:52
mongodb-database-tools 100.10.0           main   2024-12-02 17:10:50
mongosh                2.3.7              extras 2024-12-22 12:57:28
motrix                 1.8.19             extras 2024-12-02 17:45:13
nodejs-lts             22.12.0            main   2024-12-05 15:25:03
notepad3               6.24.1221.1        extras 2024-12-22 12:59:44
office-tool-plus       10.19.8.0          extras 2024-12-22 12:59:49
oh-my-posh             24.17.1            main   2024-12-25 22:26:58
openjdk21              21.0.2-13          java   2024-12-05 15:46:33
pandoc                 3.6.1              main   2024-12-25 22:27:12
picgo                  2.3.1              extras 2024-12-02 17:32:48
pipx                   1.7.1              main   2024-12-13 20:38:34
pnpm                   9.15.2             main   2024-12-28 23:17:37
poppler                24.08.0-0          main   2024-12-22 12:47:32
r                      4.4.2              main   2024-12-02 16:39:04
registry-finder        2.59.0.0           extras 2024-12-04 14:15:35
ripgrep                14.1.1             main   2024-12-22 12:47:37
rstudio                2024.12.0-467      extras 2024-12-22 13:00:34
rtools                 4.4.6335.6327      main   2024-12-02 14:16:57
sudo                   0.2020.01.26       main   2024-09-30 13:16:29
switchhosts            4.2.0.6119         extras 2024-12-02 17:38:16
texstudio              4.8.5              extras 2024-12-14 16:06:48
thorium                128.0.6613.189     extras 2024-12-02 17:36:29
typst                  0.12.0             main   2024-12-05 15:34:13
vcredist2022           14.42.34433.0      extras 2024-12-02 16:56:57
wixtoolset             5.0.2              main   2024-11-14 10:57:52
zoxide                 0.9.6              main   2024-12-22 12:47:42
```

### 2. システムフォント

- Powershell: 'CaskaydiaMonoNerdFontMono'
- VS Code: 'CaskaydiaMonoNerdFontMono'（英語）, 'LXGW WenKai Mono'（中国語）
- Office Word: 'latinmodern-math' （数式）。

### 3. Node.js

#### ミラー管理ツール nrm

- nrm は npm レジストリーマネージャーで、ユーザーが異なるミラーソースをより簡単に管理できるようにします。以下は nrm の基本的な使い方です：

```bash
# nrm のインストール
npm install nrm -g
# すべての設定済みミラーソースを表示
nrm ls
# 新しいミラーソースの追加
nrm add <registry-name> <registry-url>
# ミラーソースの削除
nrm del <registry-name>
# 現在使用しているミラーソースの切り替え
nrm use <registry-name>
# すべてのミラーソースの速度をテスト
nrm test
```

### 3. MongoDB

#### インストール

利用 scoop 自動インストール mongodb 及びその一連のツール：

```bash
scoop bucket add main
scoop install main/mongodb
scoop install main/mongodb-database-tools

scoop bucket add extras
scoop install extras/mongosh
scoop install extras/mongodb-compass
```

#### 設定

Scoop 経由でインストールした MongoDB は、デフォルトでは Windows サービスとして設定されていませんが、手動で MongoDB を Windows サービスとして設定し、起動時に自動的に実行されるようにできます。

Scoop で MongoDB のインストール場所を確認：

```bash
scoop prefix mongodb
```

mongod shim は `$dir\bin\mongod.cfg` をデフォルトの設定ファイルとして使用します。別の設定ファイルを使用するには、`$dir\bin\mongod.exe --config NEW_CONFIG_FILE` を実行します。`NEW_CONFIG_FILE` は `mongod.cfg` を基に修正し、他の場所に保存できます。

MongoDB を手動で起動します。`data\db` と `data\log` フォルダが未作成の場合（パスは `mongod.cfg` で固定設定可能）、手動で作成してください：

```bash
<路径>\bin\mongod.exe --dbpath "<路径>\data\db" --logpath "<路径>\data\log\mongo.log" --logappend
```

新しいターミナルを開き、MongoDB が正常に起動しているか確認：

```bash
mongosh
```

MongoDB を Windows サービスとして登録：

```bash
sc.exe create MongoDB binPath= "<路径>\bin\mongod.exe --service --config <路径>\mongod.cfg" DisplayName= "MongoDB" start= "auto"
```

- `<路径>`：Scoop インストールの MongoDB パス。
- `--service`：サービスモードで実行することを指定。
- `--config`：MongoDB の設定ファイルパスを指定（オプション）。

MongoDB サービスを起動します。サービスが正常に起動すると、MongoDB はシステム起動時に自動的に実行されます：

```bash
net start MongoDB
```

<footer lang="ja" style="
  background-color: #f8f9fa;
  color: #6c757d;
  font-size: 0.85rem;
  line-height: 1.5;
  padding: 1rem 1.5rem;
  margin-top: 2rem;
  border-top: 1px solid #e9ecef;
  text-align: center;
">
  <p style="margin: 0; word-break: break-word;">
    このページは生成AIによって自動翻訳されており、不正確または不完全な情報が含まれている可能性があります。
    <a href="mailto:wenjie.xu.cn@outlook.com" style="
      color: #007bff;
      text-decoration: none;
    ">ご意見・ご指摘はこちらまで</a>。品質向上のためご協力をお願いいたします。
  </p>
</footer>
</footer>
